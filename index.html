<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kit de Seguridad Psicol√≥gica</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #e8eef3 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; }
        .hero-boat { width: 100%; max-width: 500px; margin: 10px auto 20px; padding: 30px; background: linear-gradient(135deg, #e8f4f8 0%, #b8dde6 50%, #7ec8d3 100%); border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .simple-boat { font-size: 5em; animation: floating 3s ease-in-out infinite; text-align: center; }
        @keyframes floating { 0%, 100% { transform: translateY(0) rotate(-2deg); } 50% { transform: translateY(-15px) rotate(2deg); } }
        .boat-text { text-align: center; color: #5a6c7d; margin-top: 15px; }
        h1 { color: #2c3e50; font-size: 2em; margin-bottom: 8px; }
        .subtitle { color: #5a6c7d; margin-bottom: 20px; }
        .meeting-phase, .voice-meter, .quick-actions, .truth-cards-section { background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .phase-selector { display: flex; gap: 10px; flex-wrap: wrap; }
        .phase-btn { flex: 1; min-width: 150px; padding: 15px 20px; border: 3px solid transparent; border-radius: 12px; font-size: 1em; font-weight: bold; cursor: pointer; background: #f8f9fa; color: #5a6c7d; transition: all 0.3s; }
        .phase-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .phase-btn.active { transform: scale(1.05); }
        .phase-btn.inicio.active { background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); color: white; }
        .phase-btn.durante.active { background: linear-gradient(135deg, #f7b733 0%, #ffd93d 100%); color: #333; }
        .phase-btn.cierre.active { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
        .interactive-workspace { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        .color-cards-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .voice-card { padding: 25px 15px; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s; border: 3px solid transparent; }
        .voice-card:hover { transform: translateY(-5px) scale(1.03); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .voice-card.selected { transform: scale(1.08); border-width: 4px; box-shadow: 0 15px 40px rgba(0,0,0,0.3); }
        .voice-card.green { background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); color: white; }
        .voice-card.green.selected { border-color: #56ab2f; }
        .voice-card.yellow { background: linear-gradient(135deg, #f7b733 0%, #ffd93d 100%); color: #333; }
        .voice-card.yellow.selected { border-color: #f7b733; }
        .voice-card.orange { background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); color: white; }
        .voice-card.orange.selected { border-color: #ff6b35; }
        .card-icon { font-size: 2.5em; margin-bottom: 10px; }
        .card-title { font-weight: bold; font-size: 1.1em; margin-bottom: 8px; }
        .card-desc { font-size: 0.85em; }
        .action-btn { width: 100%; padding: 18px; margin-bottom: 12px; border: none; border-radius: 12px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .action-btn:hover { transform: translateX(5px); box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .action-btn.spray { background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%); color: #2c3e50; }
        .action-btn.faro { background: linear-gradient(135deg, #a8322d 0%, #d66860 100%); color: white; }
        .action-btn.bloom { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .mode-btn { padding: 10px 20px; border: 2px solid #e0e0e0; border-radius: 8px; background: white; cursor: pointer; font-weight: 600; color: #5a6c7d; transition: all 0.3s; }
        .mode-btn:hover { transform: translateY(-2px); }
        .mode-btn.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .questions-grid { display: grid; gap: 15px; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
        .question-card { background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); padding: 25px; border-radius: 12px; cursor: pointer; transition: all 0.4s; position: relative; border: 2px solid transparent; min-height: 100px; display: flex; align-items: center; justify-content: center; text-align: center; font-weight: 500; }
        .question-card::before { content: ''; position: absolute; top: 0; left: 0; width: 6px; height: 100%; }
        .question-card:hover { transform: translateY(-8px) scale(1.03); box-shadow: 0 15px 35px rgba(0,0,0,0.15); }
        .question-card.inicio::before { background: linear-gradient(180deg, #56ab2f 0%, #a8e063 100%); }
        .question-card.inicio:hover { border-color: #56ab2f; background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%); }
        .question-card.durante::before { background: linear-gradient(180deg, #f7b733 0%, #ffd93d 100%); }
        .question-card.durante:hover { border-color: #f7b733; background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%); }
        .question-card.cierre::before { background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%); }
        .question-card.cierre:hover { border-color: #4facfe; background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%); }
        .question-phase-badge { position: absolute; top: 10px; left: 10px; padding: 4px 12px; border-radius: 20px; font-size: 0.75em; font-weight: bold; text-transform: uppercase; }
        .question-phase-badge.inicio { background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); color: white; }
        .question-phase-badge.durante { background: linear-gradient(135deg, #f7b733 0%, #ffd93d 100%); color: #333; }
        .question-phase-badge.cierre { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
        .recognition-section { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 15px; padding: 30px; color: white; box-shadow: 0 5px 20px rgba(0,0,0,0.15); }
        .shared-notice { background: rgba(255,255,255,0.2); padding: 12px 18px; border-radius: 10px; margin-bottom: 20px; font-size: 0.9em; }
        .recognition-input-group { display: flex; gap: 10px; margin-bottom: 25px; }
        .recognition-input-group input { flex: 1; padding: 15px; border: none; border-radius: 10px; font-size: 1em; }
        .recognition-input-group button { padding: 15px 30px; background: white; color: #4facfe; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .recognition-input-group button:hover:not(:disabled) { transform: scale(1.05); }
        .recognition-input-group button:disabled { opacity: 0.5; cursor: not-allowed; }
        .recognition-list { display: grid; gap: 12px; max-height: 400px; overflow-y: auto; }
        .recognition-item { background: rgba(255,255,255,0.2); padding: 18px; border-radius: 10px; border-left: 4px solid white; display: flex; justify-content: space-between; align-items: center; gap: 15px; animation: slideIn 0.5s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
        .recognition-text { flex: 1; word-break: break-word; }
        .delete-btn { background: #e74c3c; color: white; border: none; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; white-space: nowrap; }
        .delete-btn:hover:not(:disabled) { background: #c0392b; transform: scale(1.08); }
        .delete-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 20px; padding: 40px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal-content h3 { color: #2c3e50; margin-bottom: 20px; font-size: 1.8em; }
        .modal-content h4 { color: #2c3e50; margin-top: 20px; margin-bottom: 10px; }
        .modal-content p { color: #5a6c7d; line-height: 1.8; margin-bottom: 15px; }
        .modal-content .kit-item { background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid #4facfe; }
        .close-modal { background: #e74c3c; color: white; border: none; padding: 12px 25px; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 20px; transition: all 0.3s; }
        .close-modal:hover { background: #c0392b; transform: scale(1.05); }
        .spray-effect { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 10em; opacity: 0; pointer-events: none; transition: all 1.5s; z-index: 999; }
        .spray-effect.active { opacity: 0.4; font-size: 20em; }
        .spray-message { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(168, 230, 207, 0.95); padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); opacity: 0; pointer-events: none; transition: all 0.5s; z-index: 998; text-align: center; max-width: 500px; }
        .spray-message.active { opacity: 1; }
        .spray-message h3 { color: #2c3e50; margin-bottom: 10px; }
        .spray-message p { color: #5a6c7d; }
        @media (max-width: 1024px) { .interactive-workspace { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .color-cards-grid { grid-template-columns: 1fr; } .phase-selector { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† Kit de Seguridad Psicol√≥gica</h1>
            <p class="subtitle">Peque√±os gestos para grandes conversaciones</p>
            <div class="hero-boat">
                <div class="simple-boat">‚õµ</div>
                <p class="boat-text">Navegando juntos hacia conversaciones m√°s seguras</p>
            </div>
        </header>
        
        <div class="meeting-phase">
            <h2 style="color: #2c3e50; margin-bottom: 10px;">üìç Fase de la Reuni√≥n</h2>
            <p style="color: #5a6c7d; margin-bottom: 15px;">No tienes que usar todo a la vez ‚Äî elige lo que el equipo necesite ese d√≠a</p>
            <div class="phase-selector">
                <button class="phase-btn inicio active" onclick="setPhase('inicio')">üü¢ Inicio</button>
                <button class="phase-btn durante" onclick="setPhase('durante')">üü° Durante</button>
                <button class="phase-btn cierre" onclick="setPhase('cierre')">üîµ Cierre</button>
            </div>
        </div>
        
        <div class="interactive-workspace">
            <div class="voice-meter">
                <h2>üåà Tarjetas de Colores</h2>
                <p style="color: #5a6c7d; margin-bottom: 20px;">¬øQuieres decir algo sin interrumpir? Usa una tarjeta para mantener la conversaci√≥n fluida y respetuosa</p>
                <div class="color-cards-grid">
                    <div class="voice-card green" onclick="selectVoiceCard(this, 'green')">
                        <div class="card-icon">üü¢</div>
                        <div class="card-title">Verde</div>
                        <div class="card-desc">Estoy escuchando atentamente</div>
                    </div>
                    <div class="voice-card yellow" onclick="selectVoiceCard(this, 'yellow')">
                        <div class="card-icon">üü°</div>
                        <div class="card-title">Amarillo</div>
                        <div class="card-desc">Tengo una pregunta</div>
                    </div>
                    <div class="voice-card orange" onclick="selectVoiceCard(this, 'orange')">
                        <div class="card-icon">üü†</div>
                        <div class="card-title">Naranja</div>
                        <div class="card-desc">Reformulemos esto</div>
                    </div>
                </div>
            </div>
            
            <div class="quick-actions">
                <h2>‚ö° Acciones R√°pidas</h2>
                <button class="action-btn spray" onclick="activateBreathing()">üßò Pausa de Respiraci√≥n</button>
                <button class="action-btn faro" onclick="showFaro()">üåü El Faro - Tu Gu√≠a</button>
                <button class="action-btn bloom" onclick="showBloom()">üì± Curso Bloom</button>
            </div>
        </div>
        
        <div class="truth-cards-section">
            <h2>üÉè Cartas de la Verdad</h2>
            <p style="color: #5a6c7d; margin-bottom: 15px;">Peque√±as frases para grandes conversaciones. Haz clic para copiar al portapapeles</p>
            <div class="cards-display-mode">
                <button class="mode-btn active" onclick="setCardMode('all')">üìö Ver Todas</button>
                <button class="mode-btn" onclick="setCardMode('current')">üéØ Fase Actual</button>
                <button class="mode-btn" onclick="shuffleCards()">üîÄ Mezclar</button>
            </div>
            <div id="questionsContainer" class="questions-grid"></div>
        </div>
        
        <div class="recognition-section">
            <h2>üíå Tablero de Reconocimiento</h2>
            <p style="margin-bottom: 15px;">Al final de la reuni√≥n, escribe un peque√±o agradecimiento. Peque√±os gestos refuerzan la confianza y el sentido de equipo.</p>
            <div class="shared-notice">üåê <strong>Tablero compartido en tiempo real:</strong> Los reconocimientos son visibles para todos los usuarios del kit</div>
            <div class="recognition-input-group">
                <input type="text" id="recognitionInput" placeholder='Ej: "Gracias por escuchar con paciencia"' maxlength="200" />
                <button id="addBtn" onclick="addRecognition()">Agregar üíö</button>
            </div>
            <div id="recognitionList" class="recognition-list">
                <div style="text-align: center; padding: 20px;">‚è≥ Cargando...</div>
            </div>
        </div>
    </div>
    
    <div id="faroModal" class="modal">
        <div class="modal-content">
            <h3>üåü El Faro: tu gu√≠a para crear espacios seguros</h3>
            
            <p><strong>¬øQu√© es El Faro?</strong><br>
            Es una peque√±a gu√≠a que te ayuda a recordar por qu√© existe el kit, c√≥mo usarlo y c√≥mo cada elemento puede ayudarte a cuidar la seguridad psicol√≥gica del grupo.</p>
            
            <h4>üí¨ ¬øPor qu√© existe este kit?</h4>
            <p>Porque en Takeda creemos que la seguridad psicol√≥gica no nace de grandes discursos, sino de peque√±os gestos: c√≥mo escuchamos, c√≥mo preguntamos, y c√≥mo damos espacio a las ideas de los dem√°s.</p>
            <p>Este kit est√° aqu√≠ para acompa√±arte en esos momentos, fortalecer la confianza y crear reuniones donde todos puedan hablar con libertad, respeto y serenidad.</p>
            
            <h4>üéÅ ¬øQu√© contiene?</h4>
            <p style="margin-bottom: 20px;">Cada elemento tiene un prop√≥sito especial:</p>
            
            <div class="kit-item">
                <strong>üåà Tarjetas de colores</strong><br>
                ¬øQuieres decir algo sin interrumpir? Usa una tarjeta. Te ayudan a mantener la conversaci√≥n fluida y respetuosa.
            </div>
            
            <div class="kit-item">
                <strong>üíå Cartas de la verdad</strong><br>
                ¬øSientes que tu equipo necesita reflexionar o empatizar? Elige una carta: cada una invita a pensar y conectar desde la emoci√≥n.
            </div>
            
            <div class="kit-item">
                <strong>‚≠ê Tablero de reconocimiento</strong><br>
                ¬øQuieres cerrar con gratitud? Escribe un agradecimiento o algo positivo que notaste durante la reuni√≥n. ¬°Reconocer fortalece la confianza!
            </div>
            
            <div class="kit-item">
                <strong>üì± Tarjeta QR de Bloom</strong><br>
                ¬øTe gustar√≠a seguir aprendiendo sobre seguridad psicol√≥gica? Escan√©ala y descubre m√°s recursos e ideas.
            </div>
            
            <div class="kit-item">
                <strong>üßò Pausa de Respiraci√≥n</strong><br>
                ¬øNecesitas un momento para respirar antes de comenzar? Usa la pausa de respiraci√≥n guiada para marcar el inicio y centrar la energ√≠a del grupo en el espacio virtual.
            </div>
            
            <h4>ü™Ñ ¬øC√≥mo se usa?</h4>
            <p style="margin-bottom: 20px;">Este kit est√° hecho para reuniones reales: cortas, con muchas ideas y poco tiempo.<br>
            No tienes que usar todo a la vez ‚Äîelige lo que el equipo necesite ese d√≠a‚Äî.</p>
            
            <p><strong>üí≠ ¬øVas a empezar una reuni√≥n?</strong><br>
            Crea el ambiente. Usa la pausa de respiraci√≥n para marcar el inicio y elige una carta con una pregunta o emoci√≥n.</p>
            
            <p><strong>üëÇ ¬øEst√°n en plena conversaci√≥n?</strong><br>
            Ap√≥yate en las tarjetas de colores o en las cartas de la verdad. Sirven para expresar, pedir la palabra o aclarar ideas sin romper la armon√≠a.</p>
            
            <p><strong>üíñ ¬øEs momento de cerrar?</strong><br>
            T√≥mate un minuto para agradecer o reconocer algo positivo. Usa el tablero o una carta de cierre para reflexionar sobre lo aprendido.</p>
            
            <h4>üí° Recuerda</h4>
            <p>Usar el kit no es cambiar la forma de trabajar, sino mejorar c√≥mo nos escuchamos. Con el tiempo, estas peque√±as acciones hacen que las reuniones sean m√°s seguras, m√°s humanas y mucho m√°s efectivas.</p>
            
            <button class="close-modal" onclick="closeModal('faroModal')">Cerrar</button>
        </div>
    </div>
    
    <div id="bloomModal" class="modal">
        <div class="modal-content">
            <h3>üéß Seguridad Psicol√≥gica en Bloom</h3>
            <p>Cada kit incluye una tarjeta con c√≥digo QR que te lleva al curso de Bloom sobre seguridad psicol√≥gica.</p>
            <div style="text-align: center; margin: 30px 0;">
                <div style="width: 150px; height: 150px; background: #f0f0f0; margin: 0 auto; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 4em;">üì≤</div>
                <p style="margin-top: 20px; color: #5a6c7d; font-weight: 600;">Escanea el c√≥digo QR en tu tarjeta f√≠sica</p>
            </div>
            <p>Descubre herramientas para crear espacios donde todos se sientan seguros para compartir ideas y aprender de los errores.</p>
            <button class="close-modal" onclick="closeModal('bloomModal')">Cerrar</button>
        </div>
    </div>
    
    <div class="spray-effect" id="breathingEffect">
        <div style="width: 200px; height: 200px; background: radial-gradient(circle, #a8e6cf 0%, #56ab2f 100%); border-radius: 50%; animation: breathe 4s ease-in-out infinite;"></div>
    </div>
    <div class="spray-message" id="breathingMessage">
        <h3>üßò Pausa de Respiraci√≥n</h3>
        <p><strong>Inhala profundo... Exhala despacio...</strong></p>
        <p style="font-style: italic; margin-top: 10px;">T√≥mate un momento para centrar tu energ√≠a</p>
    </div>
    
    <style>
        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.5); opacity: 0.8; }
        }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script>
        // Firebase configuration - Your Takeda Safety Kit Database
        const firebaseConfig = {
            apiKey: "AIzaSyDE1460OmvvTk8S0gVJTbUU4JAHXS-f8EM",
            authDomain: "safety-kit-takeda.firebaseapp.com",
            databaseURL: "https://safety-kit-takeda-default-rtdb.firebaseio.com",
            projectId: "safety-kit-takeda",
            storageBucket: "safety-kit-takeda.firebasestorage.app",
            messagingSenderId: "474966309246",
            appId: "1:474966309246:web:a09c6f325c0b0c7c461b2f"
        };
        
        // Initialize Firebase with error handling
        let database;
        let firebaseInitialized = false;
        
        try {
            if (typeof firebase !== 'undefined') {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                database = firebase.database();
                firebaseInitialized = true;
                console.log('Firebase initialized successfully');
            } else {
                console.error('Firebase library not loaded');
            }
        } catch (e) {
            console.error("Firebase initialization error:", e);
        }
        
        const questions = {
            inicio: ["¬øC√≥mo nos sentimos hoy?", "¬øQu√© es algo peque√±o que te hizo sonre√≠r esta semana?", "¬øCu√°l es el objetivo de nuestra reuni√≥n?"],
            durante: ["¬øYa escuchamos todos los puntos de vista?", "¬øNos estamos haciendo entender?", "¬øNecesitamos alg√∫n ejemplo para entender mejor?"],
            cierre: ["¬øCu√°l es la idea que me llevo de la conversaci√≥n?", "¬øQu√© apreciamos de c√≥mo nos escuchamos hoy?", "¬øQu√© tareas nos llevamos para seguir avanzando?"]
        };
        
        const phaseLabels = { inicio: 'üü¢ Inicio', durante: 'üü° Durante', cierre: 'üîµ Cierre' };
        let currentPhase = 'inicio', cardDisplayMode = 'all';
        
        document.addEventListener('DOMContentLoaded', function() {
            updateQuestions();
            loadRecognitions();
            document.getElementById('recognitionInput').addEventListener('keypress', e => { if (e.key === 'Enter') addRecognition(); });
        });
        
        function setPhase(phase) {
            currentPhase = phase;
            document.querySelectorAll('.phase-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateQuestions();
        }
        
        function setCardMode(mode) {
            cardDisplayMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateQuestions();
        }
        
        function updateQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            let questionsToShow = [];
            
            if (cardDisplayMode === 'current') {
                questions[currentPhase].forEach((q, i) => questionsToShow.push({ text: q, phase: currentPhase }));
            } else {
                Object.keys(questions).forEach(phase => questions[phase].forEach(q => questionsToShow.push({ text: q, phase: phase })));
            }
            
            questionsToShow.forEach(q => {
                const card = document.createElement('div');
                card.className = `question-card ${q.phase}`;
                const badge = document.createElement('div');
                badge.className = `question-phase-badge ${q.phase}`;
                badge.textContent = phaseLabels[q.phase];
                const text = document.createElement('div');
                text.textContent = q.text;
                text.style.paddingTop = '25px';
                card.appendChild(badge);
                card.appendChild(text);
                card.onclick = () => { navigator.clipboard.writeText(q.text); showNotification('‚úÖ Copiado: ' + q.text.substring(0, 30) + '...'); };
                container.appendChild(card);
            });
        }
        
        function shuffleCards() {
            const container = document.getElementById('questionsContainer');
            const cards = Array.from(container.children);
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            container.innerHTML = '';
            cards.forEach(card => container.appendChild(card));
            showNotification('üîÄ Cartas mezcladas');
        }
        
        async function loadRecognitions() {
            if (!firebaseInitialized || !database) {
                document.getElementById('recognitionList').innerHTML = '<div style="text-align:center;padding:20px;color:#e74c3c;">‚ö†Ô∏è Conectando con la base de datos...</div>';
                // Retry after 2 seconds
                setTimeout(() => {
                    if (firebaseInitialized && database) {
                        loadRecognitions();
                    } else {
                        document.getElementById('recognitionList').innerHTML = '<div style="text-align:center;padding:20px;color:#e74c3c;">‚ùå No se pudo conectar. Recarga la p√°gina.</div>';
                    }
                }, 2000);
                return;
            }
            
            try {
                const ref = database.ref('recognitions');
                ref.orderByChild('timestamp').limitToLast(50).on('value', (snapshot) => {
                    const items = [];
                    snapshot.forEach((childSnapshot) => {
                        items.push({
                            key: childSnapshot.key,
                            data: childSnapshot.val()
                        });
                    });
                    items.reverse(); // Most recent first
                    displayRecognitions(items);
                });
            } catch (e) {
                console.error('Error loading:', e);
                document.getElementById('recognitionList').innerHTML = '<div style="text-align:center;padding:20px;color:#e74c3c;">‚ùå Error al cargar reconocimientos</div>';
            }
        }
        
        function displayRecognitions(items) {
            const list = document.getElementById('recognitionList');
            if (items.length === 0) {
                list.innerHTML = '<div style="text-align:center;padding:20px;font-style:italic;">No hay reconocimientos a√∫n. ¬°S√© el primero!</div>';
                return;
            }
            list.innerHTML = '';
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'recognition-item';
                const text = document.createElement('span');
                text.className = 'recognition-text';
                text.textContent = item.data.emoji + ' "' + item.data.text + '"';
                const btn = document.createElement('button');
                btn.className = 'delete-btn';
                btn.textContent = 'üóëÔ∏è Eliminar';
                btn.onclick = () => deleteRecognition(item.key);
                div.appendChild(text);
                div.appendChild(btn);
                list.appendChild(div);
            });
        }
        
        async function addRecognition() {
            const input = document.getElementById('recognitionInput');
            const text = input.value.trim();
            if (!text) return;
            
            if (!firebaseInitialized || !database) {
                showNotification('‚ùå Base de datos no disponible. Recarga la p√°gina.');
                return;
            }
            
            const btn = document.getElementById('addBtn');
            btn.disabled = true;
            
            try {
                const emojis = ['üíö', '‚ú®', 'üåü', 'üí´', 'üôå', 'üëè', 'üíô', 'üéØ'];
                const emoji = emojis[Math.floor(Math.random() * emojis.length)];
                
                const ref = database.ref('recognitions');
                await ref.push({
                    text: text,
                    emoji: emoji,
                    timestamp: Date.now()
                });
                
                input.value = '';
                showNotification('‚úÖ Reconocimiento agregado');
            } catch (e) {
                showNotification('‚ùå Error al guardar');
                console.error('Error:', e);
            } finally {
                btn.disabled = false;
            }
        }
        
        async function deleteRecognition(key) {
            if (!firebaseInitialized || !database) {
                showNotification('‚ùå Base de datos no disponible');
                return;
            }
            
            try {
                const ref = database.ref('recognitions/' + key);
                await ref.remove();
                showNotification('üóëÔ∏è Eliminado');
            } catch (e) {
                showNotification('‚ùå Error al eliminar');
                console.error('Error:', e);
            }
        }
        
        function selectVoiceCard(card, color) {
            document.querySelectorAll('.voice-card').forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
            const msgs = { green: 'üü¢ Escuchando atentamente', yellow: 'üü° Tengo una pregunta', orange: 'üü† Reformulemos esto' };
            showNotification(msgs[color]);
        }
        
        function activateBreathing() {
            const effect = document.getElementById('breathingEffect');
            const message = document.getElementById('breathingMessage');
            effect.classList.add('active');
            message.classList.add('active');
            showNotification('üßò Respira... Inhala... Exhala...');
            setTimeout(() => {
                effect.classList.remove('active');
                message.classList.remove('active');
            }, 8000);
        }
        
        function showFaro() { document.getElementById('faroModal').classList.add('active'); }
        function showBloom() { document.getElementById('bloomModal').classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        
        function showNotification(msg) {
            const n = document.createElement('div');
            n.style.cssText = 'position:fixed;top:20px;right:20px;background:linear-gradient(135deg,#56ab2f 0%,#a8e063 100%);color:white;padding:15px 25px;border-radius:10px;box-shadow:0 5px 20px rgba(0,0,0,0.3);z-index:2000;';
            n.textContent = msg;
            document.body.appendChild(n);
            setTimeout(() => n.remove(), 2000);
        }
        
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', e => { if (e.target === modal) modal.classList.remove('active'); });
        });
    </script>
</body>
</html>

